# =============================================================================
# Vagrant Environment Overlay
# =============================================================================
# This overlay patches the base applications with vagrant-specific values.
# =============================================================================
apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

namespace: argocd

resources:
  - ../../base

patches:
  # MetalLB Config - vagrant overlay path
  - target:
      kind: Application
      name: metallb-config
    patch: |-
      - op: replace
        path: /spec/source/path
        value: k8s/infrastructure/metallb/overlays/vagrant

  # Cert-Manager Resources - vagrant overlay path
  - target:
      kind: Application
      name: cert-manager-resources
    patch: |-
      - op: replace
        path: /spec/source/path
        value: k8s/infrastructure/cert-manager-resources/overlays/vagrant

  # Traefik - vagrant LoadBalancer IP
  - target:
      kind: Application
      name: traefik
    patch: |-
      - op: replace
        path: /spec/source/helm/valuesObject/service/annotations/metallb.universe.tf~1loadBalancerIPs
        value: "192.168.56.200"

  # ArgoCD Ingress - vagrant overlay path
  - target:
      kind: Application
      name: argocd-ingress
    patch: |-
      - op: replace
        path: /spec/source/path
        value: k8s/infrastructure/argocd/overlays/vagrant

  # Atlantis Ingress - vagrant overlay path
  - target:
      kind: Application
      name: atlantis-ingress
    patch: |-
      - op: replace
        path: /spec/source/path
        value: k8s/infrastructure/atlantis/overlays/vagrant

  # Traefik Middleware - vagrant overlay path (includes dashboard)
  - target:
      kind: Application
      name: traefik-middleware
    patch: |-
      - op: replace
        path: /spec/source/path
        value: k8s/infrastructure/traefik/overlays/vagrant
