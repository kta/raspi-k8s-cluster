# Proxmox HA Kubernetes Cluster (GitOps Edition)

Raspberry Pi 5 Ã— 3å°ã§æ§‹ç¯‰ã™ã‚‹é«˜å¯ç”¨æ€§ Kubernetes ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼

## ğŸ¯ ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ¦‚è¦

ã“ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¯ã€Terraform ã¨ Cloud-Init ã‚’ä½¿ç”¨ã—ã¦ã€Proxmox VE ä¸Šã«å®Œå…¨è‡ªå‹•åŒ–ã•ã‚ŒãŸ Kubernetes ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ã‚’æ§‹ç¯‰ã—ã¾ã™ã€‚

### ä¸»è¦ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ

- **ç‰©ç†å±¤**: Raspberry Pi 5 (8GB) Ã— 3å°
- **ä»®æƒ³åŒ–**: Proxmox VE (Pimox)
- **ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸**: Ceph åˆ†æ•£ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ (3ãƒãƒ¼ãƒ‰æ§‹æˆ)
- **Kubernetes**: v1.35 (kubeadm)
- **CNI**: Flannel ã¾ãŸã¯ Cilium
- **GitOps**: ArgoCD
- **IaC**: Terraform + Cloud-Init

## ğŸ“ ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   pi-node-1     â”‚   pi-node-2     â”‚   pi-node-3     â”‚
â”‚  (.101)         â”‚  (.102)         â”‚  (.103)         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ pve-vm-cp-1     â”‚ pve-vm-cp-2     â”‚ pve-vm-cp-3     â”‚
â”‚ (.201)          â”‚ (.202)          â”‚ (.203)          â”‚
â”‚                 â”‚                 â”‚                 â”‚
â”‚ pve-vm-wk-1     â”‚ pve-vm-wk-2     â”‚ pve-vm-wk-3     â”‚
â”‚ (.211)          â”‚ (.212)          â”‚ (.213)          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â†‘
         kube-vip VIP: 192.168.100.200
```

## ğŸš€ ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—æ‰‹é †

### å‰ææ¡ä»¶ï¼ˆã‚¤ãƒ³ãƒ•ãƒ©ï¼‰

1. âœ… Raspberry Pi 5 Ã— 3å°ã« Proxmox VE (Pimox) ãŒã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ¸ˆã¿
2. âœ… Proxmox ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ãŒæ§‹æˆæ¸ˆã¿ (3ãƒãƒ¼ãƒ‰)
3. âœ… Ceph ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ãƒ—ãƒ¼ãƒ«ãŒæ§‹ç¯‰æ¸ˆã¿ (ãƒ—ãƒ¼ãƒ«å: `ceph-vm`)
4. âœ… æœ‰ç·š LAN ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯è¨­å®šå®Œäº†
5. âœ… Proxmox API ãƒˆãƒ¼ã‚¯ãƒ³ãŒç™ºè¡Œæ¸ˆã¿

### é–‹ç™ºç’°å¢ƒã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ï¼ˆãƒ­ãƒ¼ã‚«ãƒ«ãƒã‚·ãƒ³ï¼‰

Homebrewã§å¿…è¦ãªãƒ„ãƒ¼ãƒ«ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ï¼š

```bash
# Terraform ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç®¡ç†ãƒ„ãƒ¼ãƒ«
brew install tfenv

# Terraform ã‚’æŒ‡å®šãƒãƒ¼ã‚¸ãƒ§ãƒ³ã§ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
tfenv install $(cat .terraform-version)
tfenv use $(cat .terraform-version)

# Terraform ã®ãƒªãƒ³ãƒ†ã‚£ãƒ³ã‚°ãƒ„ãƒ¼ãƒ«
brew install tflint

# TFLint ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã®åˆæœŸåŒ–
tflint --init

# Kubernetes CLI
brew install kubectl

# ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰Proxmox ç®¡ç†ç”¨
brew install jq curl
```

ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ç¢ºèªï¼š

```bash
terraform version   # 1.10.5 ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã¯ãš
tflint --version
kubectl version --client
```

## ğŸ¯ é–‹ç™ºã‚¿ã‚¹ã‚¯

é€²æ—ã¯ [TODO.md](./TODO.md) ã§ç®¡ç†ã—ã¦ã„ã¾ã™ã€‚

## ğŸ“š ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

- [Copilot Instructions](./.github/copilot-instructions.md)

---

**Built with â¤ï¸ for Raspberry Pi Kubernetes**
